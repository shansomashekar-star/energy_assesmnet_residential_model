<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energy Assessment Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
        }

        .form-section {
            padding: 40px;
            background: #f8f9fa;
        }

        .results-section {
            padding: 40px;
            background: white;
            max-height: 80vh;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 0.9em;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 20px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .score-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
        }

        .score-value {
            font-size: 4em;
            font-weight: bold;
            margin: 10px 0;
        }

        .score-grade {
            font-size: 2em;
            opacity: 0.9;
        }

        .score-label {
            font-size: 1.2em;
            margin-top: 10px;
            opacity: 0.9;
        }

        .usage-breakdown {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .usage-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .usage-item h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 0.9em;
        }

        .usage-item .value {
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
        }

        .usage-item .label {
            color: #666;
            font-size: 0.85em;
            margin-top: 5px;
        }

        .recommendations {
            margin-top: 30px;
        }

        .recommendation {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .recommendation-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .recommendation-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
            flex: 1;
        }

        .priority-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .priority-high {
            background: #ff6b6b;
            color: white;
        }

        .priority-medium {
            background: #ffd93d;
            color: #333;
        }

        .priority-low {
            background: #6bcf7f;
            color: white;
        }

        .recommendation-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .detail-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
        }

        .detail-item label {
            font-size: 0.8em;
            color: #666;
            margin-bottom: 5px;
        }

        .detail-item .value {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
        }

        .financial-summary {
            background: #e8f5e9;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .financial-summary h3 {
            color: #2e7d32;
            margin-bottom: 15px;
        }

        .financial-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 20px;
            border-radius: 10px;
            margin: 20px;
        }

        @media (max-width: 968px) {
            .content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè† Energy Assessment Tool</h1>
            <p>Comprehensive Home Energy Analysis & Recommendations</p>
        </div>

        <div class="content">
            <div class="form-section">
                <h2 style="margin-bottom: 30px; color: #333;">Home Information</h2>
                <form id="auditForm">
                    <div class="form-group">
                        <label>Location (Division)</label>
                        <select id="division" required>
                            <option value="Northeast">Northeast</option>
                            <option value="Midwest">Midwest</option>
                            <option value="South">South</option>
                            <option value="West">West</option>
                        </select>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Home Size (sqft)</label>
                            <input type="number" id="sqft" value="2400" required min="500" max="10000">
                        </div>
                        <div class="form-group">
                            <label>Number of Occupants</label>
                            <input type="number" id="occupants" value="4" required min="1" max="20">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Heating Degree Days (HDD)</label>
                            <input type="number" id="hdd" value="5500" required>
                        </div>
                        <div class="form-group">
                            <label>Cooling Degree Days (CDD)</label>
                            <input type="number" id="cdd" value="800" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Year Built Range</label>
                        <select id="yearBuilt" required>
                            <option value="1">Before 1950</option>
                            <option value="2">1950-1959</option>
                            <option value="3">1960-1969</option>
                            <option value="4">1970-1979</option>
                            <option value="5" selected>1980-1989</option>
                            <option value="6">1990-1999</option>
                            <option value="7">2000-2009</option>
                            <option value="8">2010-2020</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Home Type</label>
                        <select id="homeType" required>
                            <option value="1">Mobile Home</option>
                            <option value="2" selected>Single Family Detached</option>
                            <option value="3">Single Family Attached</option>
                            <option value="4">Apartment (2-4 units)</option>
                            <option value="5">Apartment (5+ units)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Insulation Quality</label>
                        <select id="insulation" required>
                            <option value="1">Well Insulated</option>
                            <option value="2" selected>Adequate</option>
                            <option value="3">Poor</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Draftiness Level</label>
                        <select id="drafty" required>
                            <option value="1">Not Drafty</option>
                            <option value="2">Slightly Drafty</option>
                            <option value="3" selected>Somewhat Drafty</option>
                            <option value="4">Very Drafty</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Main Heating Equipment</label>
                        <select id="heatingEquip" required>
                            <option value="1">Heat Pump</option>
                            <option value="2">Steam/Hot Water</option>
                            <option value="3" selected>Furnace</option>
                            <option value="4">Boiler</option>
                            <option value="5">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Heating Fuel</label>
                        <select id="heatingFuel" required>
                            <option value="1" selected>Natural Gas</option>
                            <option value="2">Electricity</option>
                            <option value="3">Propane</option>
                            <option value="4">Fuel Oil</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Cooling System</label>
                        <select id="cooling" required>
                            <option value="1" selected>Central AC</option>
                            <option value="2">Heat Pump</option>
                            <option value="3">Window Units</option>
                            <option value="4">No Cooling</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Water Heater Fuel</label>
                        <select id="waterFuel" required>
                            <option value="1" selected>Natural Gas</option>
                            <option value="2">Electricity</option>
                            <option value="3">Propane</option>
                            <option value="4">Fuel Oil</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Number of Refrigerators</label>
                        <input type="number" id="numFridge" value="1" min="0" max="5">
                    </div>

                    <div class="form-group">
                        <label>Refrigerator Age</label>
                        <select id="fridgeAge">
                            <option value="1">Less than 1 year</option>
                            <option value="2">1-5 years</option>
                            <option value="3" selected>6-10 years</option>
                            <option value="4">11-15 years</option>
                            <option value="5">16-20 years</option>
                            <option value="6">More than 20 years</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>LED Lighting Percentage</label>
                        <select id="ledLighting">
                            <option value="1">0-25%</option>
                            <option value="2" selected>26-50%</option>
                            <option value="3">51-75%</option>
                            <option value="4">76-100%</option>
                        </select>
                    </div>

                    <button type="submit" id="submitBtn">Get Energy Assessment</button>
                </form>
            </div>

            <div class="results-section" id="resultsSection">
                <div style="text-align: center; padding: 60px 20px; color: #999;">
                    <p style="font-size: 1.2em;">Fill out the form and click "Get Energy Assessment" to see your results</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8001/audit';

        document.getElementById('auditForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const resultsSection = document.getElementById('resultsSection');
            
            // Disable button and show loading
            submitBtn.disabled = true;
            submitBtn.textContent = 'Analyzing...';
            
            resultsSection.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Analyzing your home's energy profile...</p>
                </div>
            `;

            // Build request payload
            const payload = {
                TOTSQFT_EN: parseFloat(document.getElementById('sqft').value),
                HDD65: parseFloat(document.getElementById('hdd').value),
                CDD65: parseFloat(document.getElementById('cdd').value),
                NHSLDMEM: parseInt(document.getElementById('occupants').value),
                DIVISION: document.getElementById('division').value,
                TYPEHUQ: document.getElementById('homeType').value,
                YEARMADERANGE: document.getElementById('yearBuilt').value,
                ADQINSUL: document.getElementById('insulation').value,
                DRAFTY: document.getElementById('drafty').value,
                EQUIPM: document.getElementById('heatingEquip').value,
                FUELHEAT: document.getElementById('heatingFuel').value,
                ACEQUIPM_PUB: document.getElementById('cooling').value,
                FUELH2O: document.getElementById('waterFuel').value,
                NUMFRIG: parseInt(document.getElementById('numFridge').value),
                AGERFRI1: document.getElementById('fridgeAge').value,
                LGTINLED: document.getElementById('ledLighting').value,
                // Add defaults for required fields
                UATYP10: 'U',
                WALLTYPE: '1',
                ROOFTYPE: '1',
                WINDOWS: '3',
                WHEATSIZ: '3',
                WHEATBKT: '0',
                AGECWASH: '3',
                AGEDW: '3',
                SMARTMETER: '0',
                EDUCATION: '4',
                EMPLOYHH: '1',
                SDESCENT: '0',
                PAYHELP: '0',
                NOHEATBROKE: '0'
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                displayResults(data);
                
            } catch (error) {
                console.error('Error:', error);
                resultsSection.innerHTML = `
                    <div class="error">
                        <h3>Error</h3>
                        <p>Failed to get energy assessment. Please make sure the API server is running on ${API_URL}</p>
                        <p style="margin-top: 10px; font-size: 0.9em; color: #666;">Error details: ${error.message}</p>
                    </div>
                `;
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Get Energy Assessment';
            }
        });

        function displayResults(data) {
            const resultsSection = document.getElementById('resultsSection');
            
            if (data.status !== 'success') {
                resultsSection.innerHTML = `<div class="error">Invalid response from server</div>`;
                return;
            }

            const score = data.energy_score;
            const usage = data.current_usage;
            const breakdown = data.usage_breakdown;
            const recommendations = data.recommendations || [];
            const financial = data.financial_summary || {};
            const projected = data.projected_usage || {};

            let html = `
                <div class="score-card">
                    <div class="score-value">${score.overall}</div>
                    <div class="score-grade">Grade: ${score.grade}</div>
                    <div class="score-label">${score.label}</div>
                </div>

                <div class="usage-breakdown">
                    <div class="usage-item">
                        <h3>Annual Cost</h3>
                        <div class="value">$${usage.annual_cost.toLocaleString()}</div>
                        <div class="label">$${Math.round(usage.monthly_avg).toLocaleString()}/month</div>
                    </div>
                    <div class="usage-item">
                        <h3>Energy Use</h3>
                        <div class="value">${usage.total_kbtu.toLocaleString()}</div>
                        <div class="label">kBTU/year</div>
                    </div>
                    <div class="usage-item">
                        <h3>EUI</h3>
                        <div class="value">${usage.eui}</div>
                        <div class="label">kBTU/sqft</div>
                    </div>
                </div>

                <div class="financial-summary">
                    <h3>üí∞ Financial Summary</h3>
                    <div class="financial-grid">
                        <div class="detail-item">
                            <label>Total Investment</label>
                            <div class="value">$${financial.total_investment?.toLocaleString() || '0'}</div>
                        </div>
                        <div class="detail-item">
                            <label>Annual Savings</label>
                            <div class="value">$${financial.total_annual_savings?.toLocaleString() || '0'}</div>
                        </div>
                        <div class="detail-item">
                            <label>Lifetime Savings</label>
                            <div class="value">$${financial.total_lifetime_savings?.toLocaleString() || '0'}</div>
                        </div>
                        <div class="detail-item">
                            <label>Avg Payback</label>
                            <div class="value">${financial.average_payback || '0'} years</div>
                        </div>
                    </div>
                </div>

                <div class="recommendations">
                    <h2 style="margin-bottom: 20px; color: #333;">Recommendations (${recommendations.length})</h2>
            `;

            if (recommendations.length === 0) {
                html += `<p style="color: #666; padding: 20px;">No recommendations available at this time.</p>`;
            } else {
                recommendations.forEach(rec => {
                    const priority = rec.priority?.toLowerCase() || 'medium';
                    const savings = rec.savings || {};
                    const financial = rec.financial || {};
                    const cost = rec.cost || {};
                    
                    html += `
                        <div class="recommendation">
                            <div class="recommendation-header">
                                <div class="recommendation-title">${rec.title}</div>
                                <span class="priority-badge priority-${priority}">${rec.priority || 'Medium'}</span>
                            </div>
                            <p style="color: #666; margin-bottom: 15px;">${rec.description}</p>
                            <div class="recommendation-details">
                                <div class="detail-item">
                                    <label>Annual Savings</label>
                                    <div class="value">$${savings.annual_dollars?.toLocaleString() || '0'}</div>
                                </div>
                                <div class="detail-item">
                                    <label>Upfront Cost</label>
                                    <div class="value">$${cost.estimate?.toLocaleString() || '0'}</div>
                                </div>
                                <div class="detail-item">
                                    <label>Payback Period</label>
                                    <div class="value">${financial.payback_years || 'N/A'} years</div>
                                </div>
                                <div class="detail-item">
                                    <label>ROI</label>
                                    <div class="value">${financial.roi_percent?.toFixed(1) || '0'}%</div>
                                </div>
                            </div>
                            ${rec.rebates && rec.rebates.length > 0 ? `
                                <div style="margin-top: 15px; padding: 10px; background: #e3f2fd; border-radius: 5px;">
                                    <strong>Available Rebates:</strong>
                                    <ul style="margin-top: 5px; margin-left: 20px;">
                                        ${rec.rebates.map(r => `<li>${r}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
            }

            html += `</div>`;

            resultsSection.innerHTML = html;
        }
    </script>
</body>
</html>
