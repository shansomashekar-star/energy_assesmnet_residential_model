<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energy Assessment - Step by Step</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .progress-bar {
            height: 6px;
            background: rgba(255,255,255,0.3);
            margin-top: 20px;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: white;
            transition: width 0.3s;
            border-radius: 3px;
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .step-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255,255,255,0.5);
            transition: all 0.3s;
        }

        .step-dot.active {
            background: white;
            transform: scale(1.3);
        }

        .content {
            padding: 40px;
        }

        .step {
            display: none;
        }

        .step.active {
            display: block;
        }

        .step-header {
            margin-bottom: 30px;
        }

        .step-header h2 {
            color: #333;
            font-size: 1.8em;
            margin-bottom: 10px;
        }

        .step-header p {
            color: #666;
            font-size: 1.1em;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
            font-size: 1em;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .tip-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .tip-box strong {
            color: #1976d2;
        }

        .tip-box p {
            color: #555;
            margin-top: 5px;
            font-size: 0.95em;
        }

        .button-group {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            gap: 15px;
        }

        button {
            padding: 14px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            flex: 1;
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #666;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .results {
            display: none;
        }

        .results.active {
            display: block;
        }

        .loading {
            text-align: center;
            padding: 60px 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .score-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
        }

        .score-value {
            font-size: 5em;
            font-weight: bold;
            margin: 10px 0;
        }

        .score-grade {
            font-size: 2.5em;
            opacity: 0.9;
        }

        .usage-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .usage-card {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
        }

        .usage-card h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 0.95em;
        }

        .usage-card .value {
            font-size: 2em;
            font-weight: bold;
            color: #333;
        }

        .recommendation {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 5px solid #667eea;
        }

        .recommendation-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .recommendation-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
        }

        .priority-badge {
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .priority-high { background: #ff6b6b; color: white; }
        .priority-medium { background: #ffd93d; color: #333; }
        .priority-low { background: #6bcf7f; color: white; }

        .recommendation-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .detail-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
        }

        .detail-card label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 5px;
        }

        .detail-card .value {
            font-size: 1.4em;
            font-weight: bold;
            color: #333;
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè† Energy Assessment</h1>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="step-indicator" id="stepIndicator"></div>
        </div>

        <div class="content">
            <!-- Step 1: About Your Home -->
            <div class="step active" id="step1">
                <div class="step-header">
                    <h2>About Your Home</h2>
                    <p>Tell us about your home's basics</p>
                </div>

                <div class="form-group">
                    <label>Zip Code <span style="color: #999; font-weight: normal;">(we'll find your state automatically)</span></label>
                    <input type="text" id="zipCode" placeholder="Enter 5-digit zip code" maxlength="5" pattern="[0-9]{5}">
                </div>

                <div class="form-group">
                    <label>Approximate Square Footage</label>
                    <input type="number" id="squareFootage" placeholder="e.g., 2000" min="500" max="20000" required>
                </div>

                <div class="form-group">
                    <label>What type of home do you have?</label>
                    <select id="homeType" required>
                        <option value="">Select your home type</option>
                        <option value="1">Mobile Home</option>
                        <option value="2">Single Family Detached</option>
                        <option value="3">Single Family Attached</option>
                        <option value="4">Apartment (2-4 units)</option>
                        <option value="5">Apartment (5+ units)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>When was your home built?</label>
                    <select id="yearBuilt" required>
                        <option value="">Select approximate age</option>
                        <option value="1">Before 1950</option>
                        <option value="2">1950-1959</option>
                        <option value="3">1960-1969</option>
                        <option value="4">1970-1979</option>
                        <option value="5">1980-1989</option>
                        <option value="6">1990-1999</option>
                        <option value="7">2000-2009</option>
                        <option value="8">2010-2020</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>How many stories?</label>
                    <select id="stories" required>
                        <option value="">Select number of stories</option>
                        <option value="1">1 Story</option>
                        <option value="2">2 Stories</option>
                        <option value="3">3+ Stories</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>How many people live here?</label>
                    <select id="occupants" required>
                        <option value="">Select number of people</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6+</option>
                    </select>
                </div>

                <div class="button-group">
                    <div></div>
                    <button type="button" class="btn-primary" onclick="nextStep()">Next: Comfort Zone ‚Üí</button>
                </div>
            </div>

            <!-- Step 2: Comfort Zone -->
            <div class="step" id="step2">
                <div class="step-header">
                    <h2>Comfort Zone</h2>
                    <p>Climate control is often the biggest energy expense. Let's see what you're working with!</p>
                </div>

                <div class="form-group">
                    <label>How do you heat your home?</label>
                    <select id="heatingType" required>
                        <option value="">Select heating type</option>
                        <option value="1">Heat Pump</option>
                        <option value="2">Steam/Hot Water System</option>
                        <option value="3">Furnace (Gas/Oil)</option>
                        <option value="4">Boiler</option>
                        <option value="5">Electric Baseboard</option>
                        <option value="6">Wood/Pellet Stove</option>
                        <option value="7">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Heating Fuel Type</label>
                    <select id="heatingFuel" required>
                        <option value="">Select fuel type</option>
                        <option value="1">Natural Gas</option>
                        <option value="2">Electricity</option>
                        <option value="3">Propane</option>
                        <option value="4">Fuel Oil</option>
                        <option value="5">Wood/Pellets</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>How do you cool your home?</label>
                    <select id="coolingType" required>
                        <option value="">Select cooling type</option>
                        <option value="1">Central Air Conditioning</option>
                        <option value="2">Heat Pump (Cooling)</option>
                        <option value="3">Window Units</option>
                        <option value="4">Evaporative Cooler</option>
                        <option value="5">No Cooling System</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>What kind of thermostat do you have?</label>
                    <select id="thermostatType" required>
                        <option value="">Select thermostat type</option>
                        <option value="1">Manual (Non-programmable)</option>
                        <option value="2">Programmable</option>
                        <option value="3">Smart/Wi-Fi Thermostat</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>How would you rate your insulation?</label>
                    <select id="insulation" required>
                        <option value="">Rate your insulation</option>
                        <option value="1">Excellent - Well Insulated</option>
                        <option value="2">Good - Adequate</option>
                        <option value="3">Fair - Could Be Better</option>
                        <option value="4">Poor - Needs Improvement</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>What type of windows do you have?</label>
                    <select id="windowType" required>
                        <option value="">Select window type</option>
                        <option value="1">Single-Pane</option>
                        <option value="2">Double-Pane (Standard)</option>
                        <option value="3">Double-Pane (Low-E)</option>
                        <option value="4">Triple-Pane</option>
                        <option value="5">Not Sure</option>
                    </select>
                </div>

                <div class="tip-box">
                    <strong>üí° Did you know?</strong>
                    <p>Upgrading to a smart thermostat can save you 10-15% on heating and cooling costs‚Äîthat's up to $200 per year for the average home!</p>
                </div>

                <div class="button-group">
                    <button type="button" class="btn-secondary" onclick="prevStep()">‚Üê Previous</button>
                    <button type="button" class="btn-primary" onclick="nextStep()">Next: Energy Bills ‚Üí</button>
                </div>
            </div>

            <!-- Step 3: Energy Bills -->
            <div class="step" id="step3">
                <div class="step-header">
                    <h2>Energy Bills</h2>
                    <p>Almost halfway there! This helps us calculate your potential savings.</p>
                </div>

                <div class="form-group">
                    <label>What's your average monthly energy bill? <span style="color: #999; font-weight: normal;">(approximate is fine)</span></label>
                    <input type="number" id="monthlyBill" placeholder="e.g., 150" min="0" max="2000" required>
                </div>

                <div class="form-group">
                    <label>Do you have solar panels?</label>
                    <select id="hasSolar" required>
                        <option value="">Select an option</option>
                        <option value="0">No, I don't have solar panels</option>
                        <option value="1">Yes, I have solar panels installed</option>
                    </select>
                </div>

                <div class="tip-box" id="solarTip" style="display: none;">
                    <strong>‚òÄÔ∏è Going solar?</strong>
                    <p>If you don't have solar panels yet, don't worry! We'll show you how solar could benefit your home in your personalized report.</p>
                </div>

                <div class="button-group">
                    <button type="button" class="btn-secondary" onclick="prevStep()">‚Üê Previous</button>
                    <button type="button" class="btn-primary" onclick="nextStep()">Next: Water & Light ‚Üí</button>
                </div>
            </div>

            <!-- Step 4: Water & Light -->
            <div class="step" id="step4">
                <div class="step-header">
                    <h2>Water & Light</h2>
                    <p>Great progress! Water heating is often an overlooked opportunity for savings.</p>
                </div>

                <div class="form-group">
                    <label>What type of water heater do you have?</label>
                    <select id="waterHeaterType" required>
                        <option value="">Select water heater type</option>
                        <option value="1">Standard Gas Tank</option>
                        <option value="2">Standard Electric Tank</option>
                        <option value="3">Tankless Gas</option>
                        <option value="4">Tankless Electric</option>
                        <option value="5">Heat Pump Water Heater</option>
                        <option value="6">Solar Water Heater</option>
                        <option value="7">Not Sure</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>How old is your water heater?</label>
                    <select id="waterHeaterAge" required>
                        <option value="">Select approximate age</option>
                        <option value="1">Less than 1 year</option>
                        <option value="2">1-5 years</option>
                        <option value="3">6-10 years</option>
                        <option value="4">11-15 years</option>
                        <option value="5">16-20 years</option>
                        <option value="6">More than 20 years</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>What's your primary lighting type?</label>
                    <select id="lightingType" required>
                        <option value="">Select primary lighting</option>
                        <option value="1">Mostly Incandescent</option>
                        <option value="2">Mix of Incandescent and CFL</option>
                        <option value="3">Mix of CFL and LED</option>
                        <option value="4">Mostly LED</option>
                    </select>
                </div>

                <div class="tip-box">
                    <strong>üí° Save with LED</strong>
                    <p>Switching to LED bulbs can save up to 75% on lighting costs. Plus, they last 25 times longer than incandescent bulbs!</p>
                </div>

                <div class="button-group">
                    <button type="button" class="btn-secondary" onclick="prevStep()">‚Üê Previous</button>
                    <button type="button" class="btn-primary" onclick="submitForm()">Get My Energy Assessment</button>
                </div>
            </div>

            <!-- Results -->
            <div class="results" id="results">
                <!-- Results will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8001/audit';
        let currentStep = 1;
        const totalSteps = 4;

        // Initialize step indicator
        function initStepIndicator() {
            const indicator = document.getElementById('stepIndicator');
            indicator.innerHTML = '';
            for (let i = 1; i <= totalSteps; i++) {
                const dot = document.createElement('div');
                dot.className = 'step-dot' + (i === 1 ? ' active' : '');
                dot.id = `stepDot${i}`;
                indicator.appendChild(dot);
            }
        }

        function updateProgress() {
            const progress = (currentStep / totalSteps) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            
            // Update step dots
            for (let i = 1; i <= totalSteps; i++) {
                const dot = document.getElementById(`stepDot${i}`);
                if (i <= currentStep) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            }
        }

        function nextStep() {
            if (validateStep(currentStep)) {
                if (currentStep < totalSteps) {
                    document.getElementById(`step${currentStep}`).classList.remove('active');
                    currentStep++;
                    document.getElementById(`step${currentStep}`).classList.add('active');
                    updateProgress();
                }
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                document.getElementById(`step${currentStep}`).classList.remove('active');
                currentStep--;
                document.getElementById(`step${currentStep}`).classList.add('active');
                updateProgress();
            }
        }

        function validateStep(step) {
            const stepElement = document.getElementById(`step${step}`);
            const requiredFields = stepElement.querySelectorAll('[required]');
            let isValid = true;

            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.style.borderColor = '#ff6b6b';
                    isValid = false;
                } else {
                    field.style.borderColor = '#e0e0e0';
                }
            });

            if (!isValid) {
                alert('Please fill in all required fields');
            }

            return isValid;
        }

        // Zip code to state/division mapping (simplified)
        function getDivisionFromZip(zip) {
            const zipNum = parseInt(zip);
            // Simplified mapping - in production, use a proper zip code database
            if (zipNum >= 1000 && zipNum < 3000) return { division: 'Northeast', hdd: 5500, cdd: 800 };
            if (zipNum >= 3000 && zipNum < 6000) return { division: 'Midwest', hdd: 6500, cdd: 600 };
            if (zipNum >= 6000 && zipNum < 9000) return { division: 'South', hdd: 3000, cdd: 2000 };
            return { division: 'West', hdd: 4000, cdd: 1500 };
        }

        // Handle solar tip
        document.getElementById('hasSolar').addEventListener('change', function() {
            const tip = document.getElementById('solarTip');
            if (this.value === '0') {
                tip.style.display = 'block';
            } else {
                tip.style.display = 'none';
            }
        });

        async function submitForm() {
            if (!validateStep(currentStep)) {
                return;
            }

            // Get zip code and determine location
            const zipCode = document.getElementById('zipCode').value;
            const location = getDivisionFromZip(zipCode);

            // Build payload
            const payload = {
                TOTSQFT_EN: parseFloat(document.getElementById('squareFootage').value),
                HDD65: location.hdd,
                CDD65: location.cdd,
                NHSLDMEM: parseInt(document.getElementById('occupants').value),
                DIVISION: location.division,
                TYPEHUQ: document.getElementById('homeType').value,
                YEARMADERANGE: document.getElementById('yearBuilt').value,
                STORIES: parseInt(document.getElementById('stories').value),
                EQUIPM: document.getElementById('heatingType').value,
                FUELHEAT: document.getElementById('heatingFuel').value,
                ACEQUIPM_PUB: document.getElementById('coolingType').value,
                PROTHERM: document.getElementById('thermostatType').value === '3' ? '1' : '0',
                THERMAIN: document.getElementById('thermostatType').value,
                ADQINSUL: document.getElementById('insulation').value,
                TYPEGLASS: document.getElementById('windowType').value,
                FUELH2O: document.getElementById('waterHeaterType').value === '1' || document.getElementById('waterHeaterType').value === '3' ? '1' : '2',
                WHEATAGE: document.getElementById('waterHeaterAge').value,
                LGTINLED: document.getElementById('lightingType').value,
                // Defaults
                UATYP10: 'U',
                WALLTYPE: '1',
                ROOFTYPE: '1',
                WINDOWS: '3',
                DRAFTY: '3',
                WHEATSIZ: '3',
                WHEATBKT: document.getElementById('waterHeaterType').value === '3' || document.getElementById('waterHeaterType').value === '4' ? '1' : '0',
                NUMFRIG: 1,
                AGERFRI1: '3',
                AGECWASH: '3',
                AGEDW: '3',
                SMARTMETER: '0',
                EDUCATION: '4',
                EMPLOYHH: '1',
                SDESCENT: '0',
                PAYHELP: '0',
                NOHEATBROKE: '0'
            };

            // Show loading
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('results').classList.add('active');
            document.getElementById('results').innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p style="font-size: 1.2em; color: #667eea; margin-top: 20px;">Analyzing your home's energy profile...</p>
                </div>
            `;

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                displayResults(data);

            } catch (error) {
                document.getElementById('results').innerHTML = `
                    <div class="error">
                        <h3>Error</h3>
                        <p>Failed to get energy assessment. Please make sure the API server is running.</p>
                        <p style="margin-top: 10px; font-size: 0.9em;">Error: ${error.message}</p>
                    </div>
                `;
            }
        }

        function displayResults(data) {
            const score = data.energy_score || {};
            const usage = data.current_usage || {};
            const recommendations = data.recommendations || [];
            const financial = data.financial_summary || {};

            let html = `
                <div class="score-card">
                    <div class="score-value">${score.overall || 'N/A'}</div>
                    <div class="score-grade">Grade: ${score.grade || 'N/A'}</div>
                    <div style="margin-top: 15px; font-size: 1.2em; opacity: 0.9;">${score.label || ''}</div>
                </div>

                <div class="usage-grid">
                    <div class="usage-card">
                        <h3>Annual Cost</h3>
                        <div class="value">$${usage.annual_cost?.toLocaleString() || '0'}</div>
                        <div style="color: #666; margin-top: 5px;">$${Math.round(usage.monthly_avg || 0).toLocaleString()}/month</div>
                    </div>
                    <div class="usage-card">
                        <h3>Energy Use</h3>
                        <div class="value">${usage.total_kbtu?.toLocaleString() || '0'}</div>
                        <div style="color: #666; margin-top: 5px;">kBTU/year</div>
                    </div>
                    <div class="usage-card">
                        <h3>EUI</h3>
                        <div class="value">${usage.eui || '0'}</div>
                        <div style="color: #666; margin-top: 5px;">kBTU/sqft</div>
                    </div>
                    <div class="usage-card">
                        <h3>CO2 Impact</h3>
                        <div class="value">${usage.carbon_tons || '0'}</div>
                        <div style="color: #666; margin-top: 5px;">tons/year</div>
                    </div>
                </div>

                <div style="background: #e8f5e9; padding: 25px; border-radius: 12px; margin-bottom: 30px;">
                    <h3 style="color: #2e7d32; margin-bottom: 15px;">üí∞ Financial Summary</h3>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                        <div>
                            <div style="color: #666; font-size: 0.9em;">Total Investment</div>
                            <div style="font-size: 1.5em; font-weight: bold; color: #333;">$${financial.total_investment?.toLocaleString() || '0'}</div>
                        </div>
                        <div>
                            <div style="color: #666; font-size: 0.9em;">Annual Savings</div>
                            <div style="font-size: 1.5em; font-weight: bold; color: #2e7d32;">$${financial.total_annual_savings?.toLocaleString() || '0'}</div>
                        </div>
                        <div>
                            <div style="color: #666; font-size: 0.9em;">Lifetime Savings</div>
                            <div style="font-size: 1.5em; font-weight: bold; color: #333;">$${financial.total_lifetime_savings?.toLocaleString() || '0'}</div>
                        </div>
                        <div>
                            <div style="color: #666; font-size: 0.9em;">Avg Payback</div>
                            <div style="font-size: 1.5em; font-weight: bold; color: #333;">${financial.average_payback || '0'} years</div>
                        </div>
                    </div>
                </div>

                <h2 style="margin-bottom: 20px; color: #333;">üí° Recommendations (${recommendations.length})</h2>
            `;

            if (recommendations.length === 0) {
                html += `<p style="color: #666; padding: 20px;">No recommendations available at this time.</p>`;
            } else {
                recommendations.forEach(rec => {
                    const priority = rec.priority?.toLowerCase() || 'medium';
                    html += `
                        <div class="recommendation">
                            <div class="recommendation-header">
                                <div class="recommendation-title">${rec.title}</div>
                                <span class="priority-badge priority-${priority}">${rec.priority || 'Medium'}</span>
                            </div>
                            <p style="color: #666; margin-bottom: 15px;">${rec.description}</p>
                            <div class="recommendation-details">
                                <div class="detail-card">
                                    <label>Annual Savings</label>
                                    <div class="value">$${rec.savings?.annual_dollars?.toLocaleString() || '0'}</div>
                                </div>
                                <div class="detail-card">
                                    <label>Upfront Cost</label>
                                    <div class="value">$${rec.cost?.estimate?.toLocaleString() || '0'}</div>
                                </div>
                                <div class="detail-card">
                                    <label>Payback Period</label>
                                    <div class="value">${rec.financial?.payback_years || 'N/A'} years</div>
                                </div>
                                <div class="detail-card">
                                    <label>ROI</label>
                                    <div class="value">${rec.financial?.roi_percent?.toFixed(1) || '0'}%</div>
                                </div>
                            </div>
                            ${rec.rebates && rec.rebates.length > 0 ? `
                                <div style="margin-top: 15px; padding: 15px; background: #e3f2fd; border-radius: 8px;">
                                    <strong style="color: #1976d2;">Available Rebates:</strong>
                                    <ul style="margin-top: 8px; margin-left: 20px; color: #555;">
                                        ${rec.rebates.map(r => `<li>${r}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
            }

            html += `
                <div style="margin-top: 40px; text-align: center;">
                    <button class="btn-primary" onclick="location.reload()" style="padding: 15px 40px;">Start New Assessment</button>
                </div>
            `;

            document.getElementById('results').innerHTML = html;
        }

        // Initialize on load
        initStepIndicator();
        updateProgress();
    </script>
</body>
</html>
